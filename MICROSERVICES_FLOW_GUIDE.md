# ğŸ—ï¸ Kiáº¿n TrÃºc Microservices - ElectroShop

## ğŸ“‹ Tá»•ng Quan

Há»‡ thá»‘ng ElectroShop Ä‘Æ°á»£c thiáº¿t káº¿ theo kiáº¿n trÃºc **Microservices**, trong Ä‘Ã³ má»—i chá»©c nÄƒng Ä‘Æ°á»£c tÃ¡ch thÃ nh cÃ¡c service Ä‘á»™c láº­p, giao tiáº¿p vá»›i nhau qua API vÃ  Message Queue.

---

## ğŸ¯ SÆ¡ Äá»“ Kiáº¿n TrÃºc Tá»•ng Thá»ƒ

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   Client/User   â”‚
                                    â”‚ (Browser/Mobile)â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚      LOAD BALANCER       â”‚
                              â”‚    (Nginx/Kong Gateway)  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚                        â”‚
                    â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    CATALOG SERVICE        â”‚ â”‚     ORDER SERVICE         â”‚ â”‚   NOTIFICATION SERVICE    â”‚
â”‚    (Quáº£n lÃ½ sáº£n pháº©m)     â”‚ â”‚   (Quáº£n lÃ½ Ä‘Æ¡n hÃ ng)      â”‚ â”‚     (Gá»­i thÃ´ng bÃ¡o)       â”‚
â”‚                           â”‚ â”‚                           â”‚ â”‚                           â”‚
â”‚  â€¢ Danh má»¥c               â”‚ â”‚  â€¢ Táº¡o Ä‘Æ¡n hÃ ng           â”‚ â”‚  â€¢ Gá»­i Email              â”‚
â”‚  â€¢ Sáº£n pháº©m               â”‚ â”‚  â€¢ Thanh toÃ¡n             â”‚ â”‚  â€¢ SMS                    â”‚
â”‚  â€¢ TÃ¬m kiáº¿m               â”‚ â”‚  â€¢ Lá»‹ch sá»­ mua hÃ ng       â”‚ â”‚  â€¢ Push notification      â”‚
â”‚  â€¢ ÄÃ¡nh giÃ¡               â”‚ â”‚  â€¢ Giá» hÃ ng               â”‚ â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                             â”‚                             â”‚
            â–¼                             â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   MySQL DB    â”‚             â”‚   MySQL DB    â”‚             â”‚   Redis Queue â”‚
    â”‚  (Products)   â”‚             â”‚   (Orders)    â”‚             â”‚   (Messages)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ CÃ¡c Luá»“ng Microservices Chi Tiáº¿t

### 1. ğŸ›ï¸ Luá»“ng Xem Sáº£n Pháº©m (Catalog Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CATALOG SERVICE FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User                    API Gateway              Catalog Service           Database
 â”‚                          â”‚                          â”‚                      â”‚
 â”‚  1. GET /products        â”‚                          â”‚                      â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚                      â”‚
 â”‚                          â”‚  2. Forward request      â”‚                      â”‚
 â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚
 â”‚                          â”‚                          â”‚  3. Query products   â”‚
 â”‚                          â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚                          â”‚                          â”‚                      â”‚
 â”‚                          â”‚                          â”‚  4. Return data      â”‚
 â”‚                          â”‚                          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                          â”‚  5. JSON Response        â”‚                      â”‚
 â”‚                          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
 â”‚  6. Display products     â”‚                          â”‚                      â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚                      â”‚
 â”‚                          â”‚                          â”‚                      â”‚
```

**MÃ´ táº£ chi tiáº¿t:**

| BÆ°á»›c | HÃ nh Ä‘á»™ng    | MÃ´ táº£                                         |
| ---- | ------------ | --------------------------------------------- |
| 1    | User request | NgÆ°á»i dÃ¹ng truy cáº­p trang sáº£n pháº©m            |
| 2    | API Gateway  | Kong/Nginx route request Ä‘áº¿n Catalog Service  |
| 3    | Query DB     | Service truy váº¥n MySQL láº¥y danh sÃ¡ch sáº£n pháº©m |
| 4    | Cache        | Káº¿t quáº£ Ä‘Æ°á»£c cache vÃ o Redis                  |
| 5    | Response     | Tráº£ vá» JSON data                              |
| 6    | Render       | Frontend hiá»ƒn thá»‹ sáº£n pháº©m                    |

**Endpoint liÃªn quan:**

```
GET  /api/products              # Láº¥y danh sÃ¡ch sáº£n pháº©m
GET  /api/products/{id}         # Chi tiáº¿t sáº£n pháº©m
GET  /api/products/search?q=    # TÃ¬m kiáº¿m sáº£n pháº©m
GET  /api/categories            # Danh sÃ¡ch danh má»¥c
```

---

### 2. ğŸ›’ Luá»“ng Äáº·t HÃ ng (Order Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ORDER SERVICE FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User          API Gateway       Order Service      Catalog Service    Notification
 â”‚                 â”‚                  â”‚                   â”‚                â”‚
 â”‚ 1. POST /order  â”‚                  â”‚                   â”‚                â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚                   â”‚                â”‚
 â”‚                 â”‚ 2. Forward       â”‚                   â”‚                â”‚
 â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                â”‚
 â”‚                 â”‚                  â”‚ 3. Check stock    â”‚                â”‚
 â”‚                 â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚
 â”‚                 â”‚                  â”‚                   â”‚                â”‚
 â”‚                 â”‚                  â”‚ 4. Stock OK       â”‚                â”‚
 â”‚                 â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
 â”‚                 â”‚                  â”‚                   â”‚                â”‚
 â”‚                 â”‚                  â”‚ 5. Create order   â”‚                â”‚
 â”‚                 â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”           â”‚                â”‚
 â”‚                 â”‚                  â”‚       â”‚ Save DB   â”‚                â”‚
 â”‚                 â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”˜           â”‚                â”‚
 â”‚                 â”‚                  â”‚                   â”‚                â”‚
 â”‚                 â”‚                  â”‚ 6. Publish event  â”‚                â”‚
 â”‚                 â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚                 â”‚                  â”‚                   â”‚                â”‚
 â”‚                 â”‚ 7. Order created â”‚                   â”‚   7. Send emailâ”‚
 â”‚                 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”        â”‚
 â”‚ 8. Confirmation â”‚                  â”‚                   â”‚       â”‚        â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”˜        â”‚
 â”‚                 â”‚                  â”‚                   â”‚                â”‚
```

**MÃ´ táº£ chi tiáº¿t:**

| BÆ°á»›c | Service              | HÃ nh Ä‘á»™ng                              |
| ---- | -------------------- | -------------------------------------- |
| 1-2  | API Gateway          | Nháº­n request Ä‘áº·t hÃ ng tá»« user          |
| 3-4  | Catalog Service      | Kiá»ƒm tra tá»“n kho sáº£n pháº©m              |
| 5    | Order Service        | Táº¡o Ä‘Æ¡n hÃ ng má»›i trong DB              |
| 6    | Message Queue        | Publish event "OrderCreated" vÃ o Redis |
| 7    | Notification Service | Consume event, gá»­i email xÃ¡c nháº­n      |
| 8    | User                 | Nháº­n pháº£n há»“i thÃ nh cÃ´ng               |

**Endpoint liÃªn quan:**

```
POST /api/orders                # Táº¡o Ä‘Æ¡n hÃ ng
GET  /api/orders/{id}           # Chi tiáº¿t Ä‘Æ¡n hÃ ng
GET  /api/orders/user/{userId}  # Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng
PUT  /api/orders/{id}/cancel    # Há»§y Ä‘Æ¡n hÃ ng
```

---

### 3. ğŸ”” Luá»“ng ThÃ´ng BÃ¡o (Notification Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       NOTIFICATION SERVICE FLOW                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Order Service        Redis Queue        Notification Service       External
     â”‚                    â”‚                      â”‚                    â”‚
     â”‚ 1. Publish event   â”‚                      â”‚                    â”‚
     â”‚ "order.created"    â”‚                      â”‚                    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                    â”‚
     â”‚                    â”‚                      â”‚                    â”‚
     â”‚                    â”‚ 2. Consumer listens  â”‚                    â”‚
     â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
     â”‚                    â”‚                      â”‚                    â”‚
     â”‚                    â”‚ 3. Deliver message   â”‚                    â”‚
     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
     â”‚                    â”‚                      â”‚                    â”‚
     â”‚                    â”‚                      â”‚ 4. Process message â”‚
     â”‚                    â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”            â”‚
     â”‚                    â”‚                      â”‚       â”‚            â”‚
     â”‚                    â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚                    â”‚                      â”‚                    â”‚
     â”‚                    â”‚                      â”‚ 5. Send email      â”‚
     â”‚                    â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ SMTP Server
     â”‚                    â”‚                      â”‚                    â”‚
     â”‚                    â”‚                      â”‚ 6. Send SMS        â”‚
     â”‚                    â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ SMS Gateway
     â”‚                    â”‚                      â”‚                    â”‚
     â”‚                    â”‚ 7. ACK message       â”‚                    â”‚
     â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
     â”‚                    â”‚                      â”‚                    â”‚
```

**CÃ¡c loáº¡i thÃ´ng bÃ¡o:**

| Event             | Trigger              | Action              |
| ----------------- | -------------------- | ------------------- |
| `order.created`   | ÄÆ¡n hÃ ng má»›i         | Gá»­i email xÃ¡c nháº­n  |
| `order.shipped`   | ÄÆ¡n hÃ ng Ä‘Æ°á»£c giao   | Gá»­i SMS tracking    |
| `order.delivered` | Giao hÃ ng thÃ nh cÃ´ng | Gá»­i email Ä‘Ã¡nh giÃ¡  |
| `user.registered` | ÄÄƒng kÃ½ má»›i          | Gá»­i email chÃ o má»«ng |
| `password.reset`  | QuÃªn máº­t kháº©u        | Gá»­i email reset     |

---

### 4. ğŸ” Luá»“ng XÃ¡c Thá»±c (Authentication Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AUTHENTICATION FLOW                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User              API Gateway           Auth Service            Redis Session
 â”‚                     â”‚                      â”‚                      â”‚
 â”‚ 1. POST /login      â”‚                      â”‚                      â”‚
 â”‚ {email, password}   â”‚                      â”‚                      â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                      â”‚
 â”‚                     â”‚ 2. Forward           â”‚                      â”‚
 â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚
 â”‚                     â”‚                      â”‚                      â”‚
 â”‚                     â”‚                      â”‚ 3. Verify credentialsâ”‚
 â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”              â”‚
 â”‚                     â”‚                      â”‚       â”‚ Check DB     â”‚
 â”‚                     â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”˜              â”‚
 â”‚                     â”‚                      â”‚                      â”‚
 â”‚                     â”‚                      â”‚ 4. Create session    â”‚
 â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚                     â”‚                      â”‚                      â”‚
 â”‚                     â”‚ 5. Return token      â”‚                      â”‚
 â”‚                     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
 â”‚ 6. Token + redirect â”‚                      â”‚                      â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚
 â”‚                     â”‚                      â”‚                      â”‚
 â”‚ 7. GET /protected   â”‚                      â”‚                      â”‚
 â”‚ (with token)        â”‚                      â”‚                      â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                      â”‚
 â”‚                     â”‚ 8. Validate token    â”‚                      â”‚
 â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚                     â”‚                      â”‚                      â”‚
 â”‚                     â”‚ 9. Token valid       â”‚                      â”‚
 â”‚                     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚                      â”‚                      â”‚
 â”‚ 10. Protected data  â”‚                      â”‚                      â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚
```

---

### 5. ğŸ’³ Luá»“ng Thanh ToÃ¡n (Payment Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PAYMENT FLOW                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User         Order Service      Payment Gateway      Bank/VNPay      Notification
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚ 1. Checkout    â”‚                    â”‚                 â”‚                â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚                 â”‚                â”‚
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚                â”‚ 2. Create payment  â”‚                 â”‚                â”‚
 â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚                â”‚
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚ 3. Redirect    â”‚                    â”‚                 â”‚                â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                 â”‚                â”‚
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚ 4. Enter card info                  â”‚                 â”‚                â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚                â”‚
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚                â”‚                    â”‚ 5. Process      â”‚                â”‚
 â”‚                â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚                â”‚                    â”‚ 6. Result       â”‚                â”‚
 â”‚                â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚                â”‚ 7. Payment success â”‚                 â”‚                â”‚
 â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                â”‚
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚                â”‚ 8. Update order    â”‚                 â”‚                â”‚
 â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”            â”‚                 â”‚                â”‚
 â”‚                â”‚       â”‚            â”‚                 â”‚                â”‚
 â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”˜            â”‚                 â”‚                â”‚
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚                â”‚ 9. Notify user     â”‚                 â”‚                â”‚
 â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚                â”‚                    â”‚                 â”‚                â”‚
 â”‚ 10. Thank you  â”‚                    â”‚                 â”‚    Email sent  â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                 â”‚                â”‚
```

---

## ğŸ“Š Mapping Services vá»›i Docker Containers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DOCKER CONTAINERS MAPPING                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         electroshop_app (:8000)                              â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚   Catalog   â”‚  â”‚    Order    â”‚  â”‚    User     â”‚  â”‚   Admin     â”‚       â”‚
â”‚   â”‚   Module    â”‚  â”‚   Module    â”‚  â”‚   Module    â”‚  â”‚   Module    â”‚       â”‚
â”‚   â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚       â”‚
â”‚   â”‚ /products   â”‚  â”‚ /orders     â”‚  â”‚ /auth       â”‚  â”‚ /admin      â”‚       â”‚
â”‚   â”‚ /categories â”‚  â”‚ /cart       â”‚  â”‚ /profile    â”‚  â”‚ /dashboard  â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                    Shared Components                             â”‚       â”‚
â”‚   â”‚  â€¢ Models (Product, Order, User, Category, etc.)                â”‚       â”‚
â”‚   â”‚  â€¢ Middleware (Auth, CORS, Rate Limiting)                       â”‚       â”‚
â”‚   â”‚  â€¢ Events & Listeners (OrderCreated, UserRegistered)            â”‚       â”‚
â”‚   â”‚  â€¢ Jobs (SendEmail, ProcessPayment)                             â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                    â”‚
                â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   electroshop_mysql       â”‚        â”‚   electroshop_redis       â”‚
â”‚        (:3308)            â”‚        â”‚        (:6380)            â”‚
â”‚                           â”‚        â”‚                           â”‚
â”‚   Tables:                 â”‚        â”‚   Keys:                   â”‚
â”‚   â€¢ users                 â”‚        â”‚   â€¢ cache:products:*      â”‚
â”‚   â€¢ products              â”‚        â”‚   â€¢ session:*             â”‚
â”‚   â€¢ categories            â”‚        â”‚   â€¢ queue:notifications   â”‚
â”‚   â€¢ orders                â”‚        â”‚   â€¢ queue:emails          â”‚
â”‚   â€¢ order_items           â”‚        â”‚                           â”‚
â”‚   â€¢ transactions          â”‚        â”‚                           â”‚
â”‚   â€¢ ratings               â”‚        â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— Giao Tiáº¿p Giá»¯a CÃ¡c Services

### Synchronous (Äá»“ng bá»™) - HTTP/REST

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP Request      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Service A  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚   Service B  â”‚
â”‚              â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     HTTP Response     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VÃ­ dá»¥:**

- Order Service â†’ Catalog Service: Kiá»ƒm tra tá»“n kho
- User Service â†’ Auth Service: XÃ¡c thá»±c token

### Asynchronous (Báº¥t Ä‘á»“ng bá»™) - Message Queue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Publish Event     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Consume     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Service A  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Redis Queue  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚   Service B  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VÃ­ dá»¥:**

- Order Service â†’ Redis â†’ Notification Service: Gá»­i email Ä‘Æ¡n hÃ ng
- Payment Service â†’ Redis â†’ Order Service: Cáº­p nháº­t tráº¡ng thÃ¡i thanh toÃ¡n

---

## ğŸ“ˆ Event-Driven Architecture

### CÃ¡c Events trong há»‡ thá»‘ng:

```php
// Events Ä‘Æ°á»£c publish
OrderCreated::class      // Khi táº¡o Ä‘Æ¡n hÃ ng má»›i
OrderPaid::class         // Khi thanh toÃ¡n thÃ nh cÃ´ng
OrderShipped::class      // Khi giao hÃ ng
OrderDelivered::class    // Khi giao thÃ nh cÃ´ng
UserRegistered::class    // Khi Ä‘Äƒng kÃ½ má»›i
PasswordReset::class     // Khi Ä‘áº·t láº¡i máº­t kháº©u
ProductViewed::class     // Khi xem sáº£n pháº©m
CartUpdated::class       // Khi cáº­p nháº­t giá» hÃ ng
```

### Event Flow:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EVENT-DRIVEN FLOW                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Event Trigger  â”‚
                    â”‚  (User Action)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Event Created  â”‚
                    â”‚ (OrderCreated)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Redis Queue    â”‚
                    â”‚  (Event Store)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚                â”‚
            â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Listener 1   â”‚ â”‚  Listener 2   â”‚ â”‚  Listener 3   â”‚
    â”‚ (Send Email)  â”‚ â”‚(Update Stock) â”‚ â”‚ (Analytics)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›¡ï¸ Service Discovery & Health Check

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HEALTH CHECK FLOW                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Docker Compose           Container              Service
     â”‚                       â”‚                     â”‚
     â”‚ 1. Health check       â”‚                     â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
     â”‚                       â”‚                     â”‚
     â”‚                       â”‚ 2. Execute check    â”‚
     â”‚                       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                       â”‚                     â”‚
     â”‚                       â”‚ 3. Response         â”‚
     â”‚                       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                       â”‚                     â”‚
     â”‚ 4. Status update      â”‚                     â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
     â”‚                       â”‚                     â”‚
     â”‚ (healthy/unhealthy)   â”‚                     â”‚
```
